<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>kaffeemaschine</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="css/bootstrap.css" rel="stylesheet">
    <link href="css/kaffeemaschine.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="../assets/ico/favicon.ico">

    <!-- fancy fonts -->
    <link href='http://fonts.googleapis.com/css?family=Dancing+Script:700' rel='stylesheet' type='text/css'>
  </head>

  <body style="height: 100%">
    <div class="container" style="text-align: center;">
      <div class="row">
	<div class="span12">
	<h1 class="fancyheader">Kaffeemaschine</h1>
	</div>
      </div>
      <div class="row">
	<div class="span12" style="background-color: #bbb">
	  <div id="microcode" style="padding-top: 2px; padding-bottom: 2px;">
	    <span class="label label-info">Microcode</span>
	    <span class="input-append">
	      <input id="microcode-mode-tf" type="text" class="input-micro"
		       placeholder="00"><button id="microcode-mode-btn"
						 class="btn"
						 type="button"
						 >Mode</button>
	      <input id="microcode-mcnext-tf" type="text" class="input-mini"
		       placeholder="0000000"><button id="microcode-mcnext-btn"
						 class="btn"
						 type="button"
						 >MCNext</button>
	      <input id="microcode-alufc-tf" type="text" class="input-mini"
		       placeholder="0000000"><button id="microcode-alufc-btn"
						 class="btn"
						 type="button"
						 >FC</button>
	      <input id="microcode-xbus-tf" type="text" class="input-mini"
		       placeholder="00000000"><button id="microcode-xbus-btn"
						 class="btn"
						 type="button"
						 >X</button>
	      <input id="microcode-ybus-tf" type="text" class="input-mini"
		       placeholder="00000000"><button id="microcode-ybus-btn"
						 class="btn"
						 type="button"
						 >Y</button>
	      <input id="microcode-zbus-tf" type="text" class="input-mini"
		       placeholder="00000000"><button id="microcode-zbus-btn"
						 class="btn"
						 type="button"
						 >Z</button>
	      <input id="microcode-ioswitch-tf" type="text" class="input-mini"
		       placeholder="0000000"><button id="microcode-ioswitch-btn"
						 class="btn"
						 type="button"
						 >IO</button>
	      <input id="microcode-byte-tf" type="text" class="input-micro"
		       placeholder="00"><button id="microcode-byte-btn"
						 class="btn"
						 type="button"
						 >Byte</button>
	    </span>
	  </div>
	</div>
      </div>
      
      
      <div class="row" style="height:553px">
	<div class="span12" style="background-color: #eee;padding-top: 10px; height: 100% ">
	
	<div id="canvas-wrap">
	  <canvas width="940px" height="530px" id="canvas" style="width: 940px; height:530px"></canvas>
	  <div id="overlay">

	<div class="row">
	  
	    <!-- left column -->
	    <div class="span4">
	
	  <!-- Power -->
	  <div id="power" class="component" style="text-align: center;">
	    <span class="label label-info">Power/Oscillator</span>
	    <div>
	      <button id="power-reset-btn" class="btn" type="button">Reset</button>
	    </div>
	    <div>
	      <button id="power-phase-btn" class="btn" type="button">Run Phase</button>
	      <button id="power-tact-btn" class="btn" type="button">Run Tact</button>
	    </div>
	  </div>
	  <!-- Power -->

	  <!-- ROM -->
	  <div id="rom" class="component" style="text-align: center;">
	    <span class="label label-info">ROM</span>
	    <div>
	      <button id="rom-rom-btn" class="btn" type="button">ROM</button>
	      <div class="input-append" style="display: inline-block">
		<input id="rom-mar-tf" type="text" class="input-mini"
		       placeholder="MAR"><button id="rom-mar-btn"
						 class="btn"
						 type="button"
						 >MAR</button>
	      </div>
	    </div>
	  </div>
	  <!-- ROM -->

	  <!-- MAC -->
	  <div id="mar" class="component" style="text-align: center;">
	    <span class="label label-info">Address Calculator</span>
	  <div>
	    <div class="input-append" style="display: inline-block">
	      <input id="mac-mcn-tf"
		     type="text"
		     class="input-mini"
		     placeholder="MCN"><button id="mac-mcn-btn"
					     class="btn"
					     type="button"
					     >MCN</button>
	    </div>
	    <div class="input-append" style="display: inline-block" >
	      <input id="mac-mcar-tf"
		     type="text"
		     class="input-mini"
		     placeholder="MCAR"><button id="mac-mcar-btn"
					     class="btn"
					     type="button"
					     >MCAR</button>
	    </div>
	  </div>
	  <div style="margin:5px">
	    <span id="mac-jumpmode-label" class="label label-inverse" style="float:
						     none">JumpMode</span>
	  </div>
	  <div class="input-append" style="display: inline-block">
	      <input id="mac-nextmc-tf"
		     type="text"
		     class="input-mini"
		     placeholder="NextMC"><button id="mac-nextmc-btn"
					     class="btn"
					     type="button"
					     >NextMC</button>
	  </div>
	  <div>
	    
	    <span id="mac-condition-badge" class="badge badge-inverse">0</span>
	   
	    <div class="input-append" style="display: inline-block" >
	      <input id="mac-mcop-tf"
		     type="text"
		     class="input-mini"
		     placeholder="MCOP"><button id="mac-mcop-btn"
					      class="btn"
					      type="button"
		                              >MCOP</button>
	    </div>
	  </div>
	  <div>
	    <div class="input-append" style="display: inline-block">
	      <input id="mac-mask-tf"
		     type="text"
		     class="input-mini"
		     placeholder="Mask"><button id="mac-mask-btn"
					     class="btn"
					     type="button"
					     >Mask</button>
	    </div>
	    <div class="input-append" style="display: inline-block" >
	      <input id="mac-cc-tf"
		     type="text"
		     class="input-mini"
		     placeholder="CC"><button id="mac-cc-btn"
					     class="btn"
					     type="button"
					     >CC</button>
	    </div>
	  </div>
	  </div>
	  <!-- MAC -->
	
	</div>
	<!-- left column -->
	
	<!-- middle column -->
	<div class="span4">
	  
	  <!-- RAM -->
	  <div id="ram" class="component" style="">
	    <span class="label label-info">RAM</span>	
	    <div>
	      <button id="ram-ram-btn" class="btn" type="button">RAM</button>
	      <div class="input-append" style="display: inline-block">
		<input id="ram-mar-tf" type="text" class="input-mini"
		       placeholder="MAR"><button id="ram-mar-btn"
						 class="btn"
						 type="button"
						 >MAR</button>
	      </div>
	    </div>
	    <div class="input-append" style="text-align: right;">
	      <input id="ram-mdr-tf"
		     type="text"
		     class="input-small"
		     placeholder="MDR"><button id="ram-mdr-btn"
					       class="btn"
					       type="button"
					       >MDR</button>
	    </div>
	    <span id="ram-mode-label" class="label label-inverse">Reading</span>
	    <span id="ram-byte-label" class="label">4 Byte</span>
	  </div>
	  <!-- RAM -->

	  <!-- Registers -->
	  <div id="registers" class="component"  style="text-align: center;">
	    <span class="label label-info">Registers</span>
	    <div class="input-append">
	      <input id="registers-r0-tf"
		     type="text"
		     class="input-small"
		     placeholder="PC"><button id="registers-r0-btn"
	                                      class="btn"
	                                      type="button"
		                              >R0</button>
	    </div>
	    <div class="input-append">
	      <input id="registers-r1-tf"
		     type="text"
		     class="input-small"
		     placeholder="A"><button id="registers-r1-btn"
					     class="btn"
					     type="button"
					     >R1</button>
	    </div>
	    <div class="input-append">
	      <input id="registers-r2-tf"
		     type="text"
		     class="input-small"
		     placeholder="B"><button id="registers-r2-btn"
	                                      class="btn"
	                                      type="button"
		                              >R2</button>
	  </div>
	  <div class="input-append">
	    <input id="registers-r3-tf"
		   type="text"
		   class="input-small"
		   placeholder="I"><button id="registers-r3-btn"
	                                      class="btn"
	                                      type="button"
		                              >R3</button>
	  </div>
	  <div class="input-append">
	    <input id="registers-r4-tf"
		   type="text"
		   class="input-small"
		   placeholder="AUX"><button id="registers-r4-btn"
	                                      class="btn"
	                                      type="button"
		                              >R4</button>
	  </div>
	  <div class="input-append">
	    <input id="registers-r5-tf"
		   type="text"
		   class="input-small"
		   placeholder="IO"><button id="registers-r5-btn"
					    class="btn"
					    type="button"
					    >R5</button>
	  </div>
	  <div class="input-append">
	    <input id="registers-r6-tf"
		   type="text"
		   class="input-small"
		   placeholder="DP"><button id="registers-r6-btn"
					    class="btn"
					    type="button"
					    >R6</button>
	  </div>
	  <div class="input-append">
	    <input id="registers-r7-tf"
		   type="text"
		   class="input-small"
		   placeholder="SP"><button id="registers-r7-btn"
					    class="btn"
					    type="button"
					    >R7</button>
	  </div>
	</div>
	<!-- Registers -->

	

      </div>
      <!-- middle column -->

      <!-- right column -->
      <div class="span4">

	<!-- Info -->
	<div id="info" class="component"  style="margin-bottom: 86px;">
	  <span class="label label-info">Info</span>
	  <div>
	    <textarea id="info-tarea" rows="10" style="resize: none;" disabled></textarea>
	  </div>
	</div>
	<!-- Info -->

	<!-- ALU -->
	<div id="alu" class="component"  style="margin-bottom: 30px;">
	  <span class="label label-info">ALU</span>
	  <div>
	    <div class="input-append" style="display: inline-block">
	      <input id="alu-x-tf"
		     type="text"
		     class="input-small"
		     placeholder="X"><button id="alu-x-btn"
					     class="btn"
					     type="button"
					     >X</button>
	    </div>
	    <div class="input-append" style="display: inline-block" >
	      <input id="alu-y-tf"
		     type="text"
		     class="input-small"
		     placeholder="Y"><button id="alu-y-btn"
					     class="btn"
					     type="button"
					     >Y</button>
	    </div>
	  </div>
	  <div style="margin:5px">
	    <span id="alu-fc-label" class="label label-inverse" style="float:
						     none">FunctionCode</span>
	  </div>
	  <div>
	    <div class="input-append" style="display: inline-block">
	      <input id="alu-z-tf"
		     type="text"
		     class="input-small"
		     placeholder="Z"><button id="alu-z-btn"
					     class="btn"
					     type="button"
					     >Z</button>
	    </div>
	    <div class="input-append" style="display: inline-block" >
	      <input id="alu-cc-tf"
		     type="text"
		     class="input-mini"
		     placeholder="CC"><button id="alu-cc-btn"
					      class="btn"
					      type="button"
		                              >CC</button>
	    </div>
	  </div>
	</div>
	<!-- ALU -->

	<!-- CC Register -->
	<div id="cc" class="component"  style="text-align: center; ">
	  <span class="label label-info">CC</span>

	  <div class="input-append">
	    <input id="cc-cc-tf"
	           type="text"
	           class="input-mini"
	           placeholder="CC"><button id="cc-cc-btn"
					    class="btn"
					    type="button"
					    >CC</button>
	  </div>
	</div>
    
	<!-- CC Register -->
	
      </div>
      <!-- right column -->

      <div>
      </div>
	</div>




	
	
	
	
      </div>
      

    </div>
  </div>
      
    </div>
    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="libs/jquery.js"></script>
    <script src="libs/bootstrap.js"></script>
    <script src="libs/coffee-script.js"></script>
    <script type="text/coffeescript">
$(window).resize( -> console.log  $('#registers-r1-btn').offset().top - $('#registers-r0-btn').offset().top )

class @ConductorPathView
  constructor: (@strokeStyle = "#000", @fillEmpty = "#fff", @lineWidth = 0.5, @pathWidth = 6) ->
    @createCanvas()
    @drawXBus()
    @drawYBus()

  drawXBus: ->
    console.log "drawing x bus"
    @context.strokeStyle = @strokeStyle
    @context.fillStyle = @fillEmpty
    @context.lineWidth = @lineWidth
    xPos = $('#registers').offset().left - $('#overlay').offset().left + $('#registers').width()
    yPos = $('#registers-r0-btn').offset().top - $('#overlay').offset().top + $('#registers-r0-btn').height()
    offX = 30
    offY = $('#registers-r1-btn').offset().top - $('#registers-r0-btn').offset().top
    middleY = 275.5
    endX = $('#alu-z-tf').offset().left - $('#overlay').offset().left + $('#alu-z-tf').width()/2
    endY = $('#alu-z-tf').offset().top - $('#overlay').offset().top

    # draw connectors register side
    for register in [0..7]
      @context.beginPath()
      @context.moveTo xPos, yPos + register * offY
      @context.lineTo xPos+offX+@pathWidth, yPos + register * offY if register is 0
      @context.lineTo xPos+offX, yPos + register * offY unless register is 0
      @context.moveTo xPos, yPos + @pathWidth + register * offY
      @context.lineTo xPos+offX, yPos + @pathWidth + register * offY unless register is 7
      @context.lineTo xPos+offX+@pathWidth, yPos + @pathWidth + register * offY if register is 7
      @context.lineTo xPos+offX, yPos + (register+1) * offY unless register is 7
      @context.stroke()
      @context.beginPath()
      @context.rect xPos, yPos + register*offY+1, offX, @pathWidth-2
      @context.fill()
    @context.beginPath()
    @context.moveTo xPos+offX+@pathWidth, yPos
    @context.lineTo xPos+offX+@pathWidth, middleY
    @context.moveTo xPos+offX+@pathWidth, middleY+@pathWidth
    @context.lineTo xPos+offX+@pathWidth, yPos + @pathWidth + 7 * offY
    @context.stroke()
    @context.beginPath()
    @context.rect xPos+offX+1, yPos+1, @pathWidth-2, 7*offY+@pathWidth-1
    @context.fill()

    #draw middle part and connector alu side
    @context.beginPath()
    @context.moveTo xPos+offX+@pathWidth, middleY
    @context.lineTo endX+@pathWidth, middleY
    @context.lineTo endX+@pathWidth, endY
    @context.moveTo xPos+offX+@pathWidth, middleY+@pathWidth
    @context.lineTo endX, middleY+@pathWidth
    @context.lineTo endX, endY
    @context.stroke()
    @context.beginPath()
    @context.rect xPos+offX+@pathWidth, middleY+1, endX-(xPos+offX+@pathWidth), @pathWidth-2
    @context.rect endX, middleY+1, @pathWidth-2, endY-middleY-1
    @context.fill()

  drawYBus: ->
    console.log "drawing y bus"
    @context.strokeStyle = @strokeStyle
    @context.lineWidth = @lineWidth
    xPos = $('#registers').offset().left - $('#overlay').offset().left + $('#registers').width()
    yPos = $('#registers-r0-btn').offset().top - $('#overlay').offset().top + $('#registers-r0-btn').height()/3
    offX = 60
    offY = $('#registers-r1-btn').offset().top - $('#registers-r0-btn').offset().top
    middleY = 245.5
    endX = $('#alu-y-tf').offset().left - $('#overlay').offset().left + $('#alu-y-tf').width()/2
    endY = $('#alu-y-tf').offset().top - $('#overlay').offset().top
    mdrX = $('#ram').offset().left - $('#overlay').offset().left + $('#ram').width()
    mdrY = $('#ram-mdr-btn').offset().top - $('#overlay').offset().top + $('#ram-mdr-btn').height()/2

    # draw connector mdr side
    @context.beginPath()
    @context.moveTo mdrX, mdrY
    @context.lineTo xPos+offX+@pathWidth, mdrY
    @context.lineTo xPos+offX+@pathWidth, yPos
    @context.moveTo mdrX, mdrY+@pathWidth
    @context.lineTo xPos+offX, mdrY+@pathWidth
    @context.lineTo xPos+offX, yPos
    @context.stroke()
    @context.beginPath()
    @context.rect mdrX, mdrY+1, xPos+offX-mdrX, @pathWidth-2
    @context.rect xPos+offX, mdrY+1, @pathWidth-2, yPos-mdrY
    @context.fill()

    # draw connectors register side
    for register in [0..7]
      @context.beginPath()
      @context.moveTo xPos, yPos + register * offY
      @context.lineTo xPos+offX, yPos + register * offY
      @context.moveTo xPos, yPos + @pathWidth + register * offY
      @context.lineTo xPos+offX, yPos + @pathWidth + register * offY unless register is 7
      @context.lineTo xPos+offX+@pathWidth, yPos + @pathWidth + register * offY if register is 7
      @context.lineTo xPos+offX, yPos + (register+1) * offY unless register is 7
      @context.stroke()
      @context.beginPath()
      @context.rect xPos, yPos + register*offY+1, offX, @pathWidth-2
      @context.fill()
    @context.beginPath()
    @context.moveTo xPos+offX+@pathWidth, yPos
    @context.lineTo xPos+offX+@pathWidth, middleY
    @context.moveTo xPos+offX+@pathWidth, middleY+@pathWidth
    @context.lineTo xPos+offX+@pathWidth, yPos + @pathWidth + 7 * offY
    @context.stroke()
    @context.beginPath()
    @context.rect xPos+offX+1, yPos+1, @pathWidth-2, 7*offY+@pathWidth-1
    @context.fill()

    #draw middle part and connector alu side
    @context.beginPath()
    @context.moveTo xPos+offX+@pathWidth, middleY
    @context.lineTo endX+@pathWidth, middleY
    @context.lineTo endX+@pathWidth, endY
    @context.moveTo xPos+offX+@pathWidth, middleY+@pathWidth
    @context.lineTo endX, middleY+@pathWidth
    @context.lineTo endX, endY
    @context.stroke()
    @context.beginPath()
    @context.rect xPos+offX+@pathWidth, middleY+1, endX-(xPos+offX+@pathWidth), @pathWidth-2
    @context.rect endX, middleY+1, @pathWidth-2, endY-middleY-1
    @context.fill()

  createCanvas: ->
    @canvas = document.getElementById 'canvas'
    @context = @canvas.getContext '2d'

  clearCanvas: ->
    @context.clearRect 0, 0, @canvas.width, @canvas.height

cpv = new ConductorPathView
console.log "cpv = #{cpv}"
    </script>
  </body>
</html>
